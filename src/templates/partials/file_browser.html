{# File browser partial with nested Date -> Lecture -> Artifacts hierarchy #}
{% if oob %}<div id="file-browser" hx-swap-oob="innerHTML">{% endif %}
    {% if lectures_by_date %}
    <div class="space-y-2">
        {% for date_key, lectures in lectures_by_date.items %}
        <details class="border rounded-md">
            <summary class="px-4 py-2 bg-gray-50 hover:bg-gray-100 rounded-t-md font-medium text-gray-700">
                ğŸ“… {{ date_key }}
                <span class="text-sm text-gray-500 ml-2">({{ lectures|length }} lecture{{ lectures|pluralize }})</span>
            </summary>

            <div class="pl-6 py-2 space-y-2">
                {% for lecture in lectures %}
                <details class="border-l-2 border-gray-200 pl-4">
                    <summary class="py-1 hover:text-blue-600 cursor-pointer font-medium group">
                        ğŸ“š 
                        <span id="lecture-title-{{ lecture.id }}">
                            {% include "partials/lecture_title.html" with lecture=lecture %}
                        </span>
                        <span class="text-sm text-gray-500 ml-2">({{ lecture.artifacts.count }} file{{ lecture.artifacts.count|pluralize }})</span>
                    </summary>

                    <div class="pl-4 py-2 space-y-1">
                        {% for artifact in lecture.artifacts.all %}
                        <div class="flex items-center space-x-2 text-sm">

                            {% if artifact.artifact_type == 'mermaid_mindmap' %}
                            <a href="{% url 'main:render_mindmap' artifact.file_name %}" target="_blank"
                                class="text-blue-600 hover:text-blue-800 hover:underline truncate flex-1">
                                <span class="text-teal-600">ğŸ§ </span>
                                <span class="text-gray-500">Mindmap</span>
                            </a>
                            {% else %}
                            <a href="{% url 'main:serve_file' artifact.file_name %}" target="_blank"
                                class="text-blue-600 hover:text-blue-800 hover:underline truncate flex-1">
                                {% if artifact.artifact_type == 'pdf_handout' %}
                                <span class="text-red-600">ğŸ“„</span>
                                <span class="text-gray-500">PDF Handout</span>
                                {% elif artifact.artifact_type == 'excel_study_table' %}
                                <span class="text-green-600">ğŸ“Š</span>
                                <span class="text-gray-500">Excel Study Table</span>
                                {% elif artifact.artifact_type == 'pdf_vignette' %}
                                <span class="text-purple-600">ğŸ“</span>
                                <span class="text-gray-500">Vignette Questions</span>
                                {% else %}
                                <span>ğŸ“</span>
                                <span class="text-gray-500">{{ artifact.file_name }}</span>
                                {% endif %}
                            </a>
                            {% endif %}

                            {% if artifact.file_size %}
                            <span class="text-gray-400 text-xs">
                                {{ artifact.file_size|filesizeformat }}
                            </span>
                            {% endif %}
                        </div>
                        {% empty %}
                        <p class="text-gray-500 text-sm">No files generated yet</p>
                        {% endfor %}
                    </div>
                </details>
                {% endfor %}
            </div>
        </details>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-8">
        <i class="fa-regular fa-folder-open mx-auto text-5xl text-gray-400"></i>
        <h3 class="mt-2 text-sm font-medium text-gray-900">No files yet</h3>
        <p class="mt-1 text-sm text-gray-500">Upload a video to generate handouts.</p>
    </div>
    {% endif %}
{% if oob %}</div>{% endif %}
