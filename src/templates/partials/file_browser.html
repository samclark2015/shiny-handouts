{# File browser partial with nested Date -> Job -> Artifacts hierarchy #}
{% if oob %}<div id="file-browser" hx-swap-oob="innerHTML">{% endif %}
    {% if jobs_by_date %}
    <div class="space-y-2">
        {% for date_key, jobs in jobs_by_date.items %}
        <details class="border rounded-md">
            <summary class="px-4 py-2 bg-gray-50 hover:bg-gray-100 rounded-t-md font-medium text-gray-700">
                üìÖ {{ date_key }}
                <span class="text-sm text-gray-500 ml-2">({{ jobs|length }} job{{ jobs|pluralize }})</span>
            </summary>

            <div class="pl-6 py-2 space-y-2">
                {% for job in jobs %}
                <details class="border-l-2 border-gray-200 pl-4">
                    <summary class="py-1 hover:text-blue-600 cursor-pointer font-medium group">
                        üìö 
                        <span id="job-title-{{ job.id }}">
                            {% include "partials/job_title.html" with job=job %}
                        </span>
                        <span class="text-sm text-gray-500 ml-2">({{ job.artifacts.count }} file{{ job.artifacts.count|pluralize }})</span>
                    </summary>

                    <div class="pl-4 py-2 space-y-1">
                        {% regroup job.artifacts.all by artifact_type as artifacts_by_type %}
                        {% for artifact in job.artifacts.all %}
                        {% if artifact.artifact_type != 'mermaid_mindmap' %}
                        <div class="flex items-center space-x-2 text-sm">
                            <a href="{% url 'main:serve_file' artifact.file_name %}" target="_blank"
                                class="text-blue-600 hover:text-blue-800 hover:underline truncate flex-1">
                                {% if artifact.artifact_type == 'pdf_handout' %}
                                <span class="text-red-600">üìÑ</span>
                                <span class="text-gray-500">PDF Handout</span>
                                {% elif artifact.artifact_type == 'excel_study_table' %}
                                <span class="text-green-600">üìä</span>
                                <span class="text-gray-500">Excel Study Table</span>
                                {% elif artifact.artifact_type == 'pdf_vignette' %}
                                <span class="text-purple-600">üìù</span>
                                <span class="text-gray-500">Vignette Questions</span>
                                {% else %}
                                <span>üìé</span>
                                <span class="text-gray-500">{{ artifact.file_name }}</span>
                                {% endif %}
                            </a>

                            {% if artifact.file_size %}
                            <span class="text-gray-400 text-xs">
                                {{ artifact.file_size|filesizeformat }}
                            </span>
                            {% endif %}
                        </div>
                        {% endif %}
                        {% empty %}
                        <p class="text-gray-500 text-sm">No files generated yet</p>
                        {% endfor %}
                        
                        {% for group in artifacts_by_type %}
                        {% if group.grouper == 'mermaid_mindmap' %}
                        {% for artifact in group.list %}
                        <div class="flex items-center space-x-2 text-sm">
                            <a href="{% url 'main:render_mindmap' artifact.file_name %}" target="_blank"
                                class="text-blue-600 hover:text-blue-800 hover:underline truncate flex-1">
                                <span class="text-teal-600">üß†</span>
                                <span class="text-gray-500">{{ artifact.file_name|default:"Mindmap" }}</span>
                            </a>
                            {% if artifact.file_size %}
                            <span class="text-gray-400 text-xs">
                                {{ artifact.file_size|filesizeformat }}
                            </span>
                            {% endif %}
                        </div>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>
                </details>
                {% endfor %}
            </div>
        </details>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-8">
        <i class="fa-regular fa-folder-open mx-auto text-5xl text-gray-400"></i>
        <h3 class="mt-2 text-sm font-medium text-gray-900">No files yet</h3>
        <p class="mt-1 text-sm text-gray-500">Upload a video to generate handouts.</p>
    </div>
    {% endif %}
{% if oob %}</div>{% endif %}
