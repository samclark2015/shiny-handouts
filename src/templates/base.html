{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Handout Generator{% endblock %}</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10/dist/ext/sse.js"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Custom styles -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    
    {% block head %}{% endblock %}
</head>
<body class="bg-gray-100 min-h-screen flex flex-col" hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
    <div class="flex-grow">
        {% block body %}{% endblock %}
    </div>
    
    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-8">
        <div class="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center text-sm text-gray-600">
                <div>
                    &copy; {% now "Y" %} Handout Generator. All rights reserved.
                </div>
                <div>
                    <button @click="$dispatch('open-bug-modal')"
                            class="text-blue-600 hover:text-blue-800 hover:underline">
                        <i class="fa-solid fa-bug mr-1"></i>Report a Bug
                    </button>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Bug Report Modal -->
    <div x-data="{ open: false }" 
         @open-bug-modal.window="open = true" 
         @keydown.escape.window="open = false">
        <div x-show="open" 
             x-transition:enter="transition ease-out duration-200"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-150"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             @click.self="open = false"
             class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"
             style="display: none;">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4" @click.stop>
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-900">Report a Bug</h3>
                        <button @click="open = false" class="text-gray-400 hover:text-gray-600">
                            <i class="fa-solid fa-times text-xl"></i>
                        </button>
                    </div>
                    
                    <form id="bug-report-form" 
                          hx-post="{% url 'main:submit_bug_report' %}"
                          hx-target="#bug-report-response"
                          hx-swap="innerHTML">
                        {% csrf_token %}
                        <div class="mb-4">
                            <label for="bug-title" class="block text-sm font-medium text-gray-700 mb-2">
                                Title:
                            </label>
                            <input type="text" 
                                   id="bug-title" 
                                   name="title"
                                   required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="Brief summary of the issue">
                        </div>
                        <div class="mb-4">
                            <label for="bug-description" class="block text-sm font-medium text-gray-700 mb-2">
                                Describe the issue you're experiencing:
                            </label>
                            <textarea id="bug-description" 
                                      name="description"
                                      rows="6"
                                      required
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                      placeholder="Please provide as much detail as possible..."></textarea>
                        </div>
                        
                        <div id="bug-report-response">
                            <div class="flex justify-end space-x-3">
                                <button type="button" 
                                        @click="open = false"
                                        class="px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md font-medium transition-colors">
                                    Cancel
                                </button>
                                <button type="submit" 
                                        class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md font-medium transition-colors">
                                    Submit Report
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    </div>
    
    <script>
        // Set timezone cookie for server-side time conversion
        (function() {
            const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
            if (tz && document.cookie.indexOf('user_timezone=') === -1) {
                document.cookie = 'user_timezone=' + tz + '; path=/; max-age=31536000; SameSite=Lax';
                // Reload to apply timezone on first visit
                location.reload();
            }
        })();
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>
