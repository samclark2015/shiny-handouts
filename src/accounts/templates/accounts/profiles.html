{% extends "base.html" %}

{% block title %}Course Profiles{% endblock %}

{% block body %}
<header class="bg-white shadow-sm">
    <div class="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8 flex justify-between items-center">
        <h1 class="text-2xl font-bold text-gray-900">Course Profiles</h1>
        <div class="flex items-center space-x-4">
            <a href="{% url 'main:index' %}" class="text-sm text-blue-600 hover:text-blue-800">Back to Dashboard</a>
            <a href="{% url 'account_logout' %}"
                class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
                Logout
            </a>
        </div>
    </div>
</header>

<main class="max-w-6xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
    {% if messages %}
    <ul class="mb-4">
        {% for message in messages %}
        <li
            class="p-3 rounded-md {% if message.tags == 'success' %}bg-green-50 text-green-700 border border-green-200{% else %}bg-red-50 text-red-700 border border-red-200{% endif %}">
            {{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}

    <div class="mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
        <p class="text-sm text-blue-800">
            <i class="fa-solid fa-info-circle mr-2"></i>
            <strong>Course Profiles</strong> let you create different configurations for different lecture types. 
            Each profile can have custom prompts and spreadsheet columns tailored to specific subjects (e.g., Pathology, Cardiology, Anatomy).
        </p>
    </div>

    <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-semibold text-gray-900">Your Profiles</h2>
        <a href="{% url 'auth:profile_create' %}"
            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors inline-flex items-center">
            <i class="fa-solid fa-plus mr-2"></i>
            Create New Profile
        </a>
    </div>

    {% if profiles %}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        {% for profile in profiles %}
        <div class="bg-white rounded-lg shadow-md p-6 border {% if profile.is_default %}border-blue-500 border-2{% else %}border-gray-200{% endif %}">
            <div class="flex justify-between items-start mb-3">
                <div class="flex-1">
                    <h3 class="text-lg font-semibold text-gray-900">
                        {{ profile.name }}
                        {% if profile.is_default %}
                        <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                            <i class="fa-solid fa-star mr-1"></i>Default
                        </span>
                        {% endif %}
                    </h3>
                    <p class="text-xs text-gray-500 mt-1">
                        Created {{ profile.created_at|date:"M d, Y" }}
                        {% if profile.updated_at != profile.created_at %}
                        â€¢ Updated {{ profile.updated_at|date:"M d, Y" }}
                        {% endif %}
                    </p>
                </div>
                <div class="flex space-x-2">
                    <a href="{% url 'auth:profile_edit' profile.id %}"
                        class="text-blue-600 hover:text-blue-800 text-sm"
                        title="Edit profile">
                        <i class="fa-solid fa-edit"></i>
                    </a>
                    <button 
                        onclick="deleteProfile({{ profile.id }}, '{{ profile.name|escapejs }}')"
                        class="text-red-600 hover:text-red-800 text-sm"
                        title="Delete profile">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </div>
            </div>

            <div class="space-y-2 text-sm text-gray-600">
                <div class="flex items-start">
                    <i class="fa-solid fa-circle-question w-5 mr-2 mt-0.5 text-gray-400"></i>
                    <span>
                        {% if profile.vignette_prompt %}
                        Custom vignette prompt
                        {% else %}
                        Default vignette prompt
                        {% endif %}
                    </span>
                </div>
                <div class="flex items-start">
                    <i class="fa-solid fa-table w-5 mr-2 mt-0.5 text-gray-400"></i>
                    <span>
                        {% if profile.spreadsheet_prompt %}
                        Custom spreadsheet prompt
                        {% else %}
                        Default spreadsheet prompt
                        {% endif %}
                    </span>
                </div>
                <div class="flex items-start">
                    <i class="fa-solid fa-table-columns w-5 mr-2 mt-0.5 text-gray-400"></i>
                    <span>
                        {{ profile.spreadsheet_columns|length }} spreadsheet columns
                    </span>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="bg-gray-50 rounded-lg p-12 text-center">
        <i class="fa-solid fa-folder-open text-5xl text-gray-300 mb-4"></i>
        <h3 class="text-lg font-medium text-gray-900 mb-2">No profiles yet</h3>
        <p class="text-gray-600 mb-4">
            Create your first course profile to customize prompts and columns for specific lecture types.
        </p>
        <a href="{% url 'auth:profile_create' %}"
            class="inline-flex items-center bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-md font-medium transition-colors">
            <i class="fa-solid fa-plus mr-2"></i>
            Create Your First Profile
        </a>
    </div>
    {% endif %}
</main>

<script>
function deleteProfile(profileId, profileName) {
    if (!confirm(`Are you sure you want to delete the profile "${profileName}"? This action cannot be undone.`)) {
        return;
    }

    fetch(`/auth/profiles/${profileId}/delete/`, {
        method: 'DELETE',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || getCookie('csrftoken'),
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            window.location.reload();
        } else {
            alert('Failed to delete profile: ' + (data.message || 'Unknown error'));
        }
    })
    .catch(error => {
        alert('Error deleting profile: ' + error);
    });
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>
{% endblock %}
